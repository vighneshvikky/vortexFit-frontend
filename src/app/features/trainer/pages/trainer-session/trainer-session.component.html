<!-- Training Sessions Template -->
<div class="training-sessions-container">


  <!-- Filters Section -->
  <div class="filters-section">
    <div class="filter-group">
      <label for="clientFilter">Filter by Client</label>
      <select
        id="clientFilter"
        class="filter-select"
        [(ngModel)]="filters.client"
      >
        <option [ngValue]="null">All Clients</option>
        <option *ngFor="let client of availableClients" [ngValue]="client">
          {{ client.name }}
        </option>
      </select>
    </div>

    <div class="filter-group">
      <label for="statusFilter">Filter by Status</label>
      <select
        id="statusFilter"
        class="filter-select"
        [(ngModel)]="filters.status"
      >
        <option value="">All Sessions</option>
        <option *ngFor="let status of availableStatuses" [value]="status">
          {{ status | titlecase }}
        </option>
      </select>
    </div>

    <div class="filter-group">
      <label for="dateFromFilter">Date From</label>
      <input
        type="date"
        id="dateFromFilter"
        class="filter-input"
        [(ngModel)]="filters.dateFrom"
      />
    </div>

    <div class="filter-group">
      <label for="dateToFilter">Date To</label>
      <input
        type="date"
        id="dateToFilter"
        class="filter-input"
        [(ngModel)]="filters.dateTo"
      />
    </div>

    <div class="filter-actions">
      <button class="apply-filters-btn" (click)="applyFilters()">
        üîç Apply Filters
      </button>
      <button class="clear-filters-btn" (click)="clearFilters()">
        ‚úñ Clear Filters
      </button>
    </div>
  </div>

  <!-- Results Summary -->
  <div class="results-summary" *ngIf="!loading">
    <p>
      Showing {{ filteredBookingData.length }} of
      {{ bookingData.length }} sessions
    </p>
  </div>

  <!-- Loading State -->
  <div *ngIf="loading" class="loading-container">
    <div class="spinner"></div>
    <p>Loading sessions...</p>
  </div>

  <!-- Sessions Table Container -->
  <div class="sessions-table-container" *ngIf="!loading">
    <!-- Table Header -->
    <div class="table-header">
      <div class="header-cell client-header">CLIENT NAME</div>
      <div class="header-cell datetime-header">DATE/TIME</div>
      <div class="header-cell session-type-header">SESSION TYPE</div>
      <div class="header-cell status-header">STATUS</div>
      <div class="header-cell actions-header">ACTIONS</div>
    </div>

    <!-- Sessions List -->
    <div class="sessions-list">
      <!-- No Results Message -->
      <div *ngIf="filteredBookingData.length === 0" class="no-results">
        <div class="no-results-icon">üìÖ</div>
        <h3>No sessions found</h3>
        <p>Try adjusting your filters or check back later for new bookings.</p>
      </div>

      <!-- Session Rows -->
      <div *ngFor="let booking of filteredBookingData" class="session-row">
        <!-- Client Info -->
        <div class="table-cell client-cell">
          <div class="client-info">
            <div class="client-name">{{ booking?.userId?.name }}</div>
          </div>
        </div>

        <!-- Date/Time -->
        <div class="table-cell datetime-cell">
          <div class="session-date">{{ formatDate(booking.date) }}</div>
          <div class="session-time">{{ booking.timeSlot }}</div>
        </div>

        <!-- Session Type -->
        <div class="table-cell session-type-cell">
          <span
            class="session-type-badge"
            [ngClass]="getSessionTypeClass(booking.sessionType)"
          >
            {{ formatSessionType(booking.sessionType) }}
          </span>
        </div>

        <!-- Status -->
        <div class="table-cell status-cell">
          <span class="status-badge" [ngClass]="getStatusClass(booking.status)">
            {{ booking.status | titlecase }}
          </span>
        </div>

        <!-- Actions -->
        <div class="table-cell actions-cell">
          <button
            class="action-btn view-btn"
            (click)="viewSession(booking._id, booking.userId._id)"
            title="View Details"
          >
            üëÅÔ∏è
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Pagination -->
  <div *ngIf="totalPages > 1" class="pagination-container">
    <app-pagination
      [currentPage]="currentPage"
      [totalPages]="totalPages"
      [maxVisiblePages]="3"
      role="trainer"
      (pageChanged)="loadFilteredDataFromServer($event)">
    </app-pagination>
  </div>
</div>

<!-- Modal (unchanged) -->
<div class="modal-overlay" *ngIf="showModal" (click)="closeModal()">
  <div class="modal-container" (click)="$event.stopPropagation()">
    <!-- Modal Header -->
    <div class="modal-header">
      <h3>Client Details</h3>
      <button class="close-btn" (click)="closeModal()">
        <span>&times;</span>
      </button>
    </div>

    

    <!-- Modal Content -->
    <div class="modal-content">
      <!-- Loading State -->
      <div *ngIf="loadingUserData" class="loading-container">
        <div class="spinner"></div>
        <p>Loading client data...</p>
      </div>

      <!-- User Data -->
      <div *ngIf="!loadingUserData && userData" class="user-details">
        <!-- User Profile Section -->
        <div class="profile-section">
          <div class="profile-image">
            <img
              [src]="userData.image"
              [alt]="userData.name"
              *ngIf="userData.image"
            />
            <div *ngIf="!userData.image" class="placeholder-image">
              {{ userData.name }}
            </div>
          </div>
          <div class="profile-info">
            <h4>{{ userData.name }}</h4>
            <p class="email">{{ userData.email }}</p>
            <span
              class="verification-badge"
              [class.verified]="userData.isVerified"
            >
              {{ userData.isVerified ? "Verified" : "Unverified" }}
            </span>
   <button
        class="w-full bg-transparent border-2 border-blue-500 hover:bg-blue-500/10 text-blue-400 hover:text-white font-semibold py-4 px-6 rounded-xl transition-all duration-200 flex items-center justify-center space-x-2 shadow-lg shadow-blue-500/25 hover:shadow-xl hover:shadow-blue-500/40 transform hover:scale-105"
        (click)="goToMessage(userData._id)"
      
      >
        <svg
          class="w-5 h-5"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"
          ></path>
        </svg>
        <span>Message Coach</span>
      </button>
          </div>
        </div>

        <!-- Details Grid -->
        <div class="details-grid">
          <div class="detail-item">
            <label>Age</label>
            <span>{{ calculateAge(userData.dob) }} years</span>
          </div>
          <div class="detail-item">
            <label>Height</label>
            <span>{{ userData.height }} {{ userData.heightUnit }}</span>
          </div>
          <div class="detail-item">
            <label>Weight</label>
            <span>{{ userData.weight }} {{ userData.weightUnit }}</span>
          </div>
          <div class="detail-item">
            <label>Fitness Level</label>
            <span>{{ userData.fitnessLevel }}</span>
          </div>
          <div class="detail-item">
            <label>Preferred Time</label>
            <span>{{ userData.preferredTime }}</span>
          </div>
          <div class="detail-item full-width">
            <label>Fitness Goals</label>
            <div class="tags">
              <span
                *ngFor="let goal of userData.fitnessGoals"
                class="tag goal-tag"
              >
                {{ goal }}
              </span>
            </div>
          </div>
          <div class="detail-item full-width">
            <label>Training Types</label>
            <div class="tags">
              <span
                *ngFor="let type of userData.trainingTypes"
                class="tag training-tag"
              >
                {{ type }}
              </span>
            </div>
          </div>
          <div class="detail-item full-width">
            <label>Equipment Available</label>
            <div class="tags">
              <span
                *ngFor="let equipment of userData.equipments"
                class="tag equipment-tag"
              >
                {{ equipment }}
              </span>
            </div>
          </div>
        </div>

        <!-- Session Details -->
        <div class="session-details" *ngIf="selectedBooking">
          <h5>Session Information</h5>
          <div class="session-info-grid">
            <div class="session-info-item">
              <label>Date</label>
              <span>{{ formatDate(selectedBooking.date) }}</span>
            </div>
            <div class="session-info-item">
              <label>Time Slot</label>
              <span>{{ selectedBooking.timeSlot }}</span>
            </div>
            <div class="session-info-item">
              <label>Session Type</label>
              <span>{{ formatSessionType(selectedBooking.sessionType) }}</span>
            </div>
            <div class="session-info-item">
              <label>Current Status</label>
              <span
                class="status-badge"
                [ngClass]="getStatusClass(selectedBooking.status)"
              >
                {{ selectedBooking.status | titlecase }}
              </span>
            </div>
          </div>
        </div>

        <!-- Status Update Section -->
        <div *ngIf="selectedBooking" class="status-update-section">
          <label for="statusSelect">Change Status:</label>
          <select
            id="statusSelect"
            class="status-select"
            [ngModel]="selectedBooking.status"
            (ngModelChange)="updateBookingStatus($event)"
          >
            <option
              *ngFor="
                let status of getAvailableStatuses(selectedBooking.status)
              "
              [value]="status"
            >
              {{ status | titlecase }}
            </option>
          </select>
        </div>
      </div>
    </div>
  </div>
</div>

