<!-- Loading State -->
<div *ngIf="isLoading" class="loading-overlay">
  <div class="loading-spinner">
    <div class="spinner"></div>
    <p>Loading trainer information...</p>
  </div>
</div>

<!-- Main Content -->
<div *ngIf="!isLoading && trainer" class="booking-container">
  <!-- Main Booking Content -->
  <div class="booking-content">
    <!-- Header -->
    <div class="booking-header">
      <div
        class="rounded-xl p-6 sm:p-8 border border-blue-500/30 bg-black/60 backdrop-blur-sm relative overflow-hidden"
      >
        <div class="text-center relative z-10">
          <h1
            class="text-3xl lg:text-4xl font-bold text-white mb-3 tracking-tight leading-tight animate-fade-in"
          >
            Book Your Session
          </h1>
          <div
            class="w-20 h-1 bg-gradient-to-r from-blue-500 to-orange-500 rounded-full mx-auto shadow-lg shadow-blue-500/50 animate-pulse"
          ></div>
          <p
            class="text-gray-300 mt-3 text-sm sm:text-base animate-fade-in-delay"
          >
            Choose your preferred session type and schedule
          </p>
        </div>
      </div>
    </div>

    <!-- Trainer Info Card -->
    <div class="trainer-card">
      <div class="trainer-info">
        <div class="trainer-avatar">
          <img
            [src]="getTrainerImage()"
            [alt]="getTrainerName()"
            class="avatar-img"
          />
          <div class="online-indicator"></div>
        </div>
        <div class="trainer-details">
          <h3 class="trainer-name">{{ getTrainerName() }}</h3>
          <div class="trainer-category">{{ getTrainerCategory() }}</div>

          <div class="trainer-essential-info">
            <div class="info-row">
              <span class="info-label">Email:</span>
              <span class="info-value">{{ trainer.email }}</span>
            </div>
            <div class="info-row">
              <span class="info-label">Contact:</span>
              <span class="info-value">{{ trainer.phoneNumber }}</span>
            </div>
            <div class="info-row">
              <span class="info-label">Experience:</span>
              <span class="info-value">{{ getTrainerExperience() }}</span>
            </div>
            <div class="info-row">
              <span class="info-label">Specialization:</span>
              <span class="info-value">{{ trainer.specialization }}</span>
            </div>
            <div class="info-row">
              <span class="info-label">Rating:</span>
              <div class="trainer-rating">
                <div class="stars">
                  <i class="fas fa-star"></i>
                  <i class="fas fa-star"></i>
                  <i class="fas fa-star"></i>
                  <i class="fas fa-star"></i>
                  <i class="fas fa-star"></i>
                </div>
                <span class="rating-text">4.9 (127 reviews)</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Session Type Selection -->
    <div class="session-selection">
      <h2 class="section-title">Choose Session Type</h2>
      <div class="session-options">
        <div
          *ngFor="let session of sessionTypes"
          class="session-card"
          [class.selected]="selectedSessionType === session.id"
          (click)="selectSessionType(session.id, session.price)"
        >
          <div class="session-icon">
            <i
              [class]="
                session.id === 'one-to-one' ? 'fas fa-user' : 'fas fa-dumbbell'
              "
            ></i>
          </div>
          <div class="session-content">
            <h3>{{ session.name }}</h3>
            <p class="session-description">{{ session.description }}</p>
            <div class="session-price">₹{{ session.price }}</div>
          </div>
          <div class="selection-indicator">
            <i class="fas fa-check"></i>
          </div>
        </div>
      </div>
    </div>

    <!-- Date & Time Picker -->
    <div class="datetime-selection">
      <h2 class="section-title">Select Date & Time</h2>

      <!-- Calendar -->
      <div class="calendar-section">
        <div class="calendar-header">
          <button class="calendar-nav" (click)="previousMonth()">
            <i class="fas fa-chevron-left"></i>
          </button>
          <h3 class="current-month">{{ currentMonthYear }}</h3>
          <button class="calendar-nav" (click)="nextMonth()">
            <i class="fas fa-chevron-right"></i>
          </button>
        </div>

        <div class="calendar-grid">
          <div class="calendar-weekdays">
            <div class="weekday">Sun</div>
            <div class="weekday">Mon</div>
            <div class="weekday">Tue</div>
            <div class="weekday">Wed</div>
            <div class="weekday">Thu</div>
            <div class="weekday">Fri</div>
            <div class="weekday">Sat</div>
          </div>

          <div class="calendar-days">
            <div
              *ngFor="let day of calendarDays"
              class="calendar-day"
              [class.other-month]="!day.isCurrentMonth"
              [class.available]="day.isAvailable"
              [class.selected]="day.isSelected"
              [class.unavailable]="!day.isAvailable"
              (click)="selectDate(day)"
              (mouseenter)="onDayHover(day)"
              (mouseleave)="onDayLeave()"
              [attr.title]="
                !day.isAvailable ? hoverMessage || 'Not available' : null
              "
            >
              {{ day.date }}
            </div>
          </div>
        </div>
      </div>

      <!-- Time Slots -->
      <div class="time-slots" *ngIf="selectedDate">
        <h3>
          Available Time Slots for {{ selectedDate | date : "MMM dd, yyyy" }}
        </h3>

        <!-- Loading state for slots -->

        <!-- Slots available OR no slots/error -->
        <ng-container *ngIf="!isLoadingSlots">
          <div *ngIf="availableTimeSlots.length > 0; else noSlots">
            <div class="slots-grid">
              <button
                *ngFor="let slot of availableTimeSlots"
                class="time-slot"
                [class.selected]="selectedTimeSlot === slot"
                (click)="selectTimeSlot(slot)"
              >
                {{ slot }}
                <span *ngIf="slot.isBooked" class="booked-label">(Booked)</span>
              </button>
            </div>
          </div>
        </ng-container>

        <!-- Fallback: no slots or error -->
        <ng-template #noSlots>
          <div class="no-slots-message">
            {{
              slotsErrorMessage ||
                "No available slots for this date. Please pick another day."
            }}
          </div>
        </ng-template>
      </div>
    </div>

    <!-- Order Summary Panel (Sticky) -->
    <div
      class="order-summary"
      *ngIf="selectedSessionType && selectedDate && selectedTimeSlot"
    >
      <div class="summary-header">
        <h3>Order Summary</h3>
      </div>
      <div class="summary-content">
        <div class="summary-item">
          <span class="label">Trainer:</span>
          <span class="value">{{ getTrainerName() }}</span>
        </div>
        <div class="summary-item">
          <span class="label">Session:</span>
          <span class="value">{{ getSessionTypeName() }}</span>
        </div>
        <div class="summary-item">
          <span class="label">Date:</span>
          <span class="value">{{ selectedDate | date : "MMM dd, yyyy" }}</span>
        </div>
        <div class="summary-item">
          <span class="label">Time:</span>
          <span class="value">{{ selectedTimeSlot }}</span>
        </div>
        <div class="summary-item total">
          <span class="label">Total:</span>
          <span class="value">₹{{ getSessionPrice() }}</span>
        </div>
      </div>
      <button class="confirm-booking-btn" (click)="confirmBooking()">
        Confirm Booking
      </button>
    </div>
  </div>
</div>
